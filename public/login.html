<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Login | Sistema</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</head>
<body class="bg-light">

<div class="container mt-5">
  <div class="card p-4 shadow-lg">

    <!-- üîô Bot√≥n Volver a Tienda -->
    <div class="mb-3">
      <a href="index.html" class="btn btn-dark">üîô Volver a la tienda</a>
    </div>

    <h3 class="text-center">üîë Autenticaci√≥n</h3>

    <!-- Secci√≥n Inicio -->
    <div id="inicioSection">
      <div class="d-flex flex-column gap-3 my-4">
        <button class="btn btn-outline-success btn-lg" onclick="mostrarFormulario('registroSection')">üìù Registrarse</button>
        <button class="btn btn-outline-primary btn-lg" onclick="mostrarFormulario('loginSection')">üîê Iniciar Sesi√≥n</button>
        <button class="btn btn-outline-warning btn-lg" onclick="mostrarFormulario('resetSection')">üîÅ Recuperar Contrase√±a</button>
      </div>
    </div>

    <!-- Registro -->
    <div id="registroSection" style="display:none;">
      <h5>Registro</h5>
      <input type="text" id="nombre" class="form-control mb-2" placeholder="Nombre" />
      <input type="email" id="correo" class="form-control mb-2" placeholder="Correo" />
      <input type="password" id="password" class="form-control mb-2" placeholder="Contrase√±a" />
      <button onclick="registrar()" class="btn btn-success w-100">Registrarse</button>
      <button onclick="mostrarFormulario('inicioSection')" class="btn btn-primary w-100 mt-3">‚¨ÖÔ∏è Volver a inicio</button>
      <hr />
    </div>

    <!-- Login -->
    <div id="loginSection" style="display:none;">
      <h5>Iniciar sesi√≥n</h5>
      <input type="email" id="loginCorreo" class="form-control mb-2" placeholder="Correo" />
      <input type="password" id="loginPassword" class="form-control mb-2" placeholder="Contrase√±a" />
      <button onclick="login()" class="btn btn-primary w-100">Iniciar Sesi√≥n</button>
      <button onclick="mostrarFormulario('inicioSection')" class="btn btn-primary w-100 mt-3">‚¨ÖÔ∏è Volver a inicio</button>
      <hr />
    </div>

    <!-- Reset -->
    <div id="resetSection" style="display:none;">
      <h5>Recuperar contrase√±a</h5>
      <input type="email" id="resetCorreo" class="form-control mb-2" placeholder="Correo" />
      <button onclick="resetPass()" class="btn btn-warning w-100">Restablecer</button>
      <button onclick="mostrarFormulario('inicioSection')" class="btn btn-primary w-100 mt-3">‚¨ÖÔ∏è Volver a inicio</button>
      <hr />
    </div>

    <!-- C√≥digo secreto -->
    <div id="codigoSecretoSection" style="display:none;">
      <h5>C√≥digo Secreto</h5>
      <input type="password" id="codigoSecreto" class="form-control mb-2" placeholder="Ingrese el c√≥digo secreto" />
      <button onclick="verificarCodigo()" class="btn btn-dark w-100">Entrar al Panel</button>
      <button onclick="mostrarFormulario('inicioSection')" class="btn btn-primary w-100 mt-3">‚¨ÖÔ∏è Volver a inicio</button>
    </div>

  </div>
</div>

<script>
const API = "http://localhost:3000/api";
const CODIGO_SECRETO = "ADMIN123";

function mostrarFormulario(id) {
  const secciones = ["inicioSection", "registroSection", "loginSection", "resetSection", "codigoSecretoSection"];
  secciones.forEach(sec => {
    document.getElementById(sec).style.display = sec === id ? "block" : "none";
  });
}

mostrarFormulario("inicioSection");

async function registrar() {
  const nombre = document.getElementById("nombre").value.trim();
  const correo = document.getElementById("correo").value.trim();
  const password = document.getElementById("password").value.trim();

  if (!nombre || !correo || !password) {
    alert("Por favor completa todos los campos para registrarte");
    return;
  }

  try {
    const res = await fetch(`${API}/register`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ nombre, correo, password })
    });
    const data = await res.json();
    alert(data.message || data.error);

    if (res.ok) {
      mostrarFormulario("loginSection");
      document.getElementById("nombre").value = "";
      document.getElementById("correo").value = "";
      document.getElementById("password").value = "";
    }
  } catch (error) {
    alert("Error en la conexi√≥n: " + error.message);
  }
}

async function login() {
  const correo = document.getElementById("loginCorreo").value.trim();
  const password = document.getElementById("loginPassword").value.trim();

  if (!correo || !password) {
    alert("Por favor ingresa correo y contrase√±a");
    return;
  }

  try {
    const res = await fetch(`${API}/login`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ correo, password })
    });
    const data = await res.json();

    if (res.ok && data.usuario) {
      alert("‚úÖ Bienvenido, " + data.usuario.nombre);
      mostrarFormulario("codigoSecretoSection");
      document.getElementById("loginCorreo").value = "";
      document.getElementById("loginPassword").value = "";
    } else {
      alert(data.error || "Error en inicio de sesi√≥n");
    }
  } catch (error) {
    alert("Error en la conexi√≥n: " + error.message);
  }
}

async function resetPass() {
  const correo = document.getElementById("resetCorreo").value.trim();

  if (!correo) {
    alert("Ingresa un correo para restablecer la contrase√±a");
    return;
  }

  try {
    const res = await fetch(`${API}/reset`, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({ correo })
    });
    const data = await res.json();
    alert(data.message || data.error);
  } catch (error) {
    alert("Error en la conexi√≥n: " + error.message);
  }
}

function verificarCodigo() {
  const codigoIngresado = document.getElementById("codigoSecreto").value.trim();

  if (!codigoIngresado) {
    alert("Por favor ingresa el c√≥digo secreto");
    return;
  }

  if (codigoIngresado === CODIGO_SECRETO) {
    alert("‚úÖ Acceso concedido");
    window.location.href = "admin.html";
  } else {
    alert("‚ùå C√≥digo incorrecto");
  }
}
</script>

</body>
</html>
